__lua__
lane_borders={
	{x1=62,y1=59,x2=37,y2=0},-- nw/n
	{x1=65,y1=59,x2=90,y2=0},-- n/ne
	{x1=68,y1=62,x2=127,y2=37},-- ne/e
	{x1=68,y1=65,x2=127,y2=90},-- e/se
	{x1=65,y1=68,x2=90,y2=127},-- se/s
	{x1=62,y1=68,x2=37,y2=127},-- s/sw
	{x1=59,y1=65,x2=0,y2=90,},-- sw/w
	{x1=59,y1=62,x2=0,y2=37},-- w/nw
}

obs={}
function create_obs(l,r)
	local ldir=lane_borders[l]
	local rdir=lane_borders[r]

	local ld={x=ldir.x1-ldir.x2,y=ldir.y1-ldir.y2}
	local rd={x=rdir.x1-rdir.x2,y=rdir.y1-rdir.y2}
	
	local new_obs={
		col=24,
		verts={
			ldir.x1,
			ldir.y1,
			rdir.x2,
			rdir.y2
		}
	}

	new_obs.update=function()
		new_obs.verts[1] = new_obs.verts[1] - (1/100)*ld.x
		new_obs.verts[2]-=(1/100)*ld.y
		
		new_obs.verts[3]-=(1/100)*rd.x
		new_obs.verts[4]-=(1/100)*rd.y
	end
		
	new_obs.draw=function()
			--render_poly(new_obs.verts, new_obs.col)
			line(
				new_obs.verts[1],
				new_obs.verts[2],
				new_obs.verts[3],
				new_obs.verts[4],
				new_obs.col)
	end
	
	obs[#obs+1]=new_obs
end

function _init()
	create_obs(2,3)
end

function drawbackground(col)
	-- center
	line(62,59,65,59,col)-- n
	line(65,59,68,62,col)-- ne
	line(68,62,68,65,col)-- e
	line(68,65,65,68,col)-- se
	line(62,68,65,68,col)-- s
	line(62,68,59,65,col)-- sw
	line(59,62,59,65,col)-- w
	line(59,62,62,59,col)-- nw

	-- dividers
	foreach(lane_borders,
		function(div)
			line(div.x1,div.y1,div.x2,div.y2,col)
		end
	)

	-- outer
	line(37,0,90,0,col)-- n
	line(90,0,127,37,col)-- ne
	line(127,37,127,90,col)-- e
	line(127,90,90,127,col)-- se
	line(90,127,37,127,col)-- s
	line(37,127,0,90,col)-- sw
	line(0,90,0,37,col)-- w
	line(0,37,37,0,col)-- nw
end

--function draw_small_obs()
--	render_poly({10, 10, 20, 10, 20, 29}, 7)
--end

function _update()
	--px-=(1/100)*d.x
	--py-=(1/100)*d.y
	--if px>dir.x2 then px = dir.x1 end
	--if py<dir.y2 then py = dir.y1 end
	foreach(obs, function(o)
		o:update()
	end)
end

function _draw()
	cls(0)
	--draw_small_obs()
	foreach(obs, function(o)
		o:draw()
	end)
	drawbackground(7)

	--pset(dir.x1,dir.y1,24)
	--pset(px,py,15)
end

__gfx__
01230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4567000000000000000000000000000d0000000000000000000000000000000000000d00000000000000000000000000000000d000000000000000000000ddd0
89ab0000000000000000000000000ddd000000000000000000000000000000000000dd0000000000000000000000000000000dd0000000000000000000ddddd0
cdef00000000000000000000000ddddd00000000000000000000000000000000000dddd00000000000000000000000000000ddd00000000000000000ddddddd0
000000000000000000000000dddddddd0000000000000000000000000000000000ddddd0000000000000000000000000000ddddd0000000000000dddddddddd0
0000000000000000000000dddddddddd000000000000000000000000000000000ddddddd00000000000000000000000000dddddd00000000000dddddddddddd0
00000000000000000000dddddddddddd00000000000000000000000000000000dddddddd0000000000000000000000000dddddddd0000000ddddddddddddddd0
00000000000000000ddddddddddddddd0000000000000000000000000000000ddddddddd000000000000000000000000ddddddddd000000dddddddddddddddd0
000000000000000ddddddddddddddddd000000000000000000000000000000ddddddddddd0000000000000000000000ddddddddddd00000dddddddddddddddd0
000000000000dddddddddddddddddddd00000000000000000000000000000dddddddddddd000000000000000000000dddddddddddd00000dddddddddddddddd0
0000000000dddddddddddddddddddddd0000000000000000000000000000dddddddddddddd0000000000000000000ddddddddddddd00000dddddddddddddddd0
00000000dddddddddddddddddddddddd000000000000000000000000000ddddddddddddddd000000000000000000ddddddddddddddd0000dddddddddddddddd0
00000ddddddddddddddddddddddddddd00000000000000000000000000ddddddddddddddddd0000000000000000dddddddddddddddd0000dddddddddddddddd0
000ddddddddddddddddddddddddddddd0000000000000000000000000dddddddddddddddddd000000000000000dddddddddddddddddd000dddddddddddddddd0
0ddddddddddddddddddddddddddddddd000000000000000000000000ddddddddddddddddddd00000000000000ddddddddddddddddddd000dddddddddddddddd0
0ddddddddddddddddddddddddddddddd00000000000000000000000ddddddddddddddddddddd000000000000dddddddddddddddddddd000dddddddddddddddd0
0ddddddddddddddddddddddddddddddd0000000000000000000000dddddddddddddddddddddd00000000000dddddddddddddddddddddd00dddddddddddddddd0
0ddddddddddddddddddddddddddddddd000000000000000000000dddddddddddddddddddddddd000000000dddddddddddddddddddddd000dddddddddddddddd0
0ddddddddddddddddddddddddddddddd00000000000000000000ddddddddddddddddddddddddd00000000dddddddddddddddddddddd0000dddddddddddddddd0
0ddddddddddddddddddddddddddddddd0000000000000000000dddddddddddddddddddddddddd0000000dddddddddddddddddddddd000000ddddddddddddddd0
0ddddddddddddddddddddddddddddddd000000000000000000dddddddddddddddddddddddddddd000000000dddddddddddddddddd0000000000dddddddddddd0
0ddddddddddddddddddddddddddddddd00000000000000000ddddddddddddddddddddddddddddd00000000000ddddddddddddddd0000000000000dddddddddd0
0ddddddddddddddddddddddddddddddd0000000000000000ddddddddddddddddddddddddddddddd000000000000dddddddddddd00000000000000000ddddddd0
0ddddddddddddddddddddddddddddddd000000000000000dddddddddddddddddddddddddddddddd000000000000000dddddddd00000000000000000000ddddd0
0ddddddddddddddddddddddddddddddd00000000000000dddddddddddddddddddddddddddddddddd0000000000000000ddddd00000000000000000000000ddd0
0ddddddddddddddddddddddddddddddd0000000000000ddddddddddddddddddddddddddddddddddd0000000000000000000d0000000000000000000000000000
0ddddddddddddddddddddddddddddddd000000000000dddddddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000
0ddddddddddddddddddddddddddddddd00000000000dddddddddddddddddddddddddddddddddddddd00000000000000000000000000000000000000d00000000
0ddddddddddddddddddddddddddddddd0000000000ddddddddddddddddddddddddddddddddddddddd0000000000000000000000000000000000000ddd0000000
0ddddddddddddddddddddddddddddddd000000000ddddddddddddddddddddddddddddddddddddddddd00000000000000000000000000000000000dddd0000000
0ddddddddddddddddddddddddddddddd00000000dddddddddddddddddddddddddddddddddddddddddd0000000000000000000000000000000000dddddd000000
0ddddddddddddddddddddddddddddddd0000000ddddddddddddddddddddddddddddddddddddddddddd000000000000000000000000000000000ddddddd000000
0ddddddddddddddddddddddddddddddd000000ddddddddddddddddddddddddddddddddddddddddddd000000000000000000000000000000000dddddddd000000
0ddddddddddddddddddddddddddddddd00000ddddddddddddddddddddddddddddddddddddddddddd000000000000000000000000000000000dddddddddd00000
0ddddddddddddddddddddddddddddddd0000ddddddddddddddddddddddddddddddddddddddddddd000000000000000000000000000000000ddddddddddd00000
0ddddddddddddddddddddddddddddddd000ddddddddddddddddddddddddddddddddddddddddddd000000000000000000000000000000000ddddddddddddd0000
0ddddddddddddddddddddddddddddddd00ddddddddddddddddddddddddddddddddddddddddddd00000000000000000000000000000000000dddddddddddd0000
0ddddddddddddddddddddddddddddddd0000dddddddddddddddddddddddddddddddddddddddd00000000000000000000000000000000000000ddddddddddd000
0ddddddddddddddddddddddddddddddd000000ddddddddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000dddddddd000
0ddddddddddddddddddddddddddddddd000000000ddddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000ddddd0000
000ddddddddddddddddddddddddddddd00000000000dddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000dd00000
00000ddddddddddddddddddddddddddd0000000000000ddddddddddddddddddddddddddd00000000000000000000000000000000000000000000000000000000
00000000dddddddddddddddddddddddd0000000000000000ddddddddddddddddddddddd000000000000000000000000000000000000000000000000000000000
0000000000dddddddddddddddddddddd000000000000000000dddddddddddddddddddd0000000000000000000000000000000000000000000000000000000000
000000000000dddddddddddddddddddd000000000000000000000dddddddddddddddd00000000000000000000000000000000000000000000000000000000000
000000000000000ddddddddddddddddd00000000000000000000000ddddddddddddd000000000000000000000000000000000000000000000000000000000000
00000000000000000ddddddddddddddd0000000000000000000000000dddddddddd0000000000000000000000000000000000000000000000000000000000000
00000000000000000000dddddddddddd0000000000000000000000000000dddddd00000000000000000000000000000000000000000000000000000000000000
0000000000000000000000dddddddddd000000000000000000000000000000ddd000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000ddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000ddd000000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000d0000000000ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000dddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000dddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000ddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000ddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000dddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000dddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000
